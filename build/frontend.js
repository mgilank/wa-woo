jQuery(document).ready((function(e){console.log("WhatsApp Checkout script loaded"),e(document).on("click",".wp-block-wa-checkout-button",(function(i){i.preventDefault(),console.log("WhatsApp button clicked");var a=e("#email").val()||e("#billing_email").val()||e('[name="billing_email"]').val();if(!a||""===a.trim()){alert("Please enter your email address before proceeding."),e("#email").addClass("wa-checkout-error"),e("#billing_email").addClass("wa-checkout-error"),e('[name="billing_email"]').addClass("wa-checkout-error");var t=e("#email").length?e("#email"):e("#billing_email").length?e("#billing_email"):e('[name="billing_email"]');return t.length&&e("html, body").animate({scrollTop:t.offset().top-100},500),!1}for(var l=!0,n=[],o=[{id:"shipping-first_name",name:"First Name"},{id:"shipping-last_name",name:"Last Name"},{id:"shipping-address_1",name:"Address"},{id:"shipping-city",name:"City"},{id:"shipping-postcode",name:"Postal Code"}],s=0;s<o.length;s++){var r=e("#"+(b=o[s]).id).val();r&&""!==r.trim()?e("#"+b.id).removeClass("wa-checkout-error"):(l=!1,e("#"+b.id).addClass("wa-checkout-error"),n.push(b.name))}if(!l){var d="Please fill in the following shipping fields:\n• "+n.join("\n• ");return alert(d),e(".wa-checkout-error").length&&e("html, body").animate({scrollTop:e(".wa-checkout-error").first().offset().top-100},500),!1}var c=e(this),p=c.data("wa-link"),m=c.data("wa-message"),h={billing:{},shipping:{},shipping_method:"",payment_method:""},g=!0,_=(d="",[]),u=["first_name","last_name","address_1","city","state","postcode","email"],f=["first_name","last_name","address_1","city","state","postcode"],v=!0;if(e("form.checkout").length)h.billing.email=a,h.shipping.first_name=e("#shipping-first_name").val(),h.shipping.last_name=e("#shipping-last_name").val(),h.shipping.address_1=e("#shipping-address_1").val(),h.shipping.city=e("#shipping-city").val(),h.shipping.postcode=e("#shipping-postcode").val();else if(console.log("No checkout form found, trying to get WooCommerce customer data"),"undefined"!=typeof wc_checkout_params)if(wc_checkout_params.customer_details){for(h.billing=wc_checkout_params.customer_details.billing||{},h.shipping=wc_checkout_params.customer_details.shipping||{},s=0;s<u.length;s++){var b=u[s];if(!h.billing[b]||""===h.billing[b].trim()){v=!1;var y=b.replace("_"," ");"first_name"===b&&(y="First Name"),"last_name"===b&&(y="Last Name"),"address_1"===b&&(y="Address"),"state"===b&&(y="Province"),"postcode"===b&&(y="Postal Code"),_.push("Billing "+y)}}for(s=0;s<f.length;s++)b=f[s],h.shipping[b]&&""!==h.shipping[b].trim()||(v=!1,y=b.replace("_"," "),"first_name"===b&&(y="First Name"),"last_name"===b&&(y="Last Name"),"address_1"===b&&(y="Address"),"state"===b&&(y="Province"),"postcode"===b&&(y="Postal Code"),_.push("Shipping "+y))}else{var w=e("#billing_first_name").val()||e('[name="billing_first_name"]').val(),k=e("#billing_last_name").val()||e('[name="billing_last_name"]').val(),C=e("#billing_address_1").val()||e('[name="billing_address_1"]').val(),A=e("#billing_city").val()||e('[name="billing_city"]').val(),F=e("#billing_state").val()||e('[name="billing_state"]').val(),P=e("#billing_postcode").val()||e('[name="billing_postcode"]').val();w&&k&&C&&A&&F&&P?(h.billing={first_name:w,last_name:k,address_1:C,city:A,state:F,postcode:P,email:a},h.shipping={first_name:e("#shipping-first_name").val()||w,last_name:e("#shipping-last_name").val()||k,address_1:e("#shipping-address_1").val()||C,city:e("#shipping-city").val()||A,state:F,postcode:e("#shipping-postcode").val()||P},console.log("Found required fields directly from DOM"),v=!0):(e(".woocommerce-billing-fields").length||e(".woocommerce-checkout-review-order").length)&&(e("[data-billing-first-name]").length||e("[data-billing]").length||e(".billing-details").length||e("#billing-details").length?(console.log("Found alternative billing fields structure"),h.billing={first_name:"Customer",last_name:"",address_1:"Address from checkout",city:"City",state:"State",postcode:"Postcode"},h.shipping=h.billing,v=!0):(v=!1,d="Please fill in your billing and shipping information before checkout."))}else w=e("#billing_first_name").val()||e('[name="billing_first_name"]').val(),k=e("#billing_last_name").val()||e('[name="billing_last_name"]').val(),C=e("#billing_address_1").val()||e('[name="billing_address_1"]').val(),A=e("#billing_city").val()||e('[name="billing_city"]').val(),F=e("#billing_state").val()||e('[name="billing_state"]').val(),P=e("#billing_postcode").val()||e('[name="billing_postcode"]').val(),w&&k&&C&&A&&F&&P?(h.billing={first_name:w,last_name:k,address_1:C,city:A,state:F,postcode:P,email:a},h.shipping={first_name:e("#shipping-first_name").val()||w,last_name:e("#shipping-last_name").val()||k,address_1:e("#shipping-address_1").val()||C,city:e("#shipping-city").val()||A,state:F,postcode:e("#shipping-postcode").val()||P},console.log("Found required fields directly from DOM without wc_checkout_params"),v=!0):(e(".woocommerce-billing-fields").length||e(".woocommerce-checkout-review-order").length)&&(console.log("Found checkout page elements, assuming billing info is available"),h.billing={first_name:"Customer",last_name:"",address_1:"Address from checkout",city:"City",state:"State",postcode:"Postcode"},h.shipping=h.billing,v=!0);if(v){console.log("Billing details valid, checking shipping and payment");var N=!0,S=!0;if("undefined"!=typeof wc_checkout_params&&!0===wc_checkout_params.cart_has_virtual_products_only&&(S=!1),0===e(".woocommerce-shipping-totals").length&&(S=!1),S){var j="",x=!1,T=e('input[name^="shipping_method"]:checked');T.length?(j=T.val(),x=!0):e("select.shipping_method").length?(j=e("select.shipping_method").val(),x=!0):e('input[name^="shipping_method"][type="hidden"]').length&&(j=e('input[name^="shipping_method"][type="hidden"]').val(),x=!0),j||1!==e(".woocommerce-shipping-methods li").length||(j=e('.woocommerce-shipping-methods input[name^="shipping_method"]').val(),x=!0),!j&&e(".woocommerce-shipping-methods li").length>0&&(N=!1,_.push("Shipping method")),j?h.shipping_method=j:S&&!x&&"undefined"!=typeof wc_checkout_params&&wc_checkout_params.chosen_shipping_methods&&(h.shipping_method=wc_checkout_params.chosen_shipping_methods[0]||"",h.shipping_method&&(N=!0))}var W="",q=e(".radio-control-wc-payment-method-options:checked");if(q.length)W=q.val(),console.log("Found payment method using custom radio class:",W);else{var D=e('input[name="payment_method"]:checked');D.length?(W=D.val(),console.log("Found payment method using standard radio:",W)):e('input[name="payment_method"][type="hidden"]').length?(W=e('input[name="payment_method"][type="hidden"]').val(),console.log("Found payment method using hidden input:",W)):1===e(".radio-control-wc-payment-method-options").length?(W=e(".radio-control-wc-payment-method-options").val(),console.log("Using single custom radio payment method:",W)):1===e(".wc_payment_methods li").length?(W=e('.wc_payment_methods input[name="payment_method"]').val(),console.log("Using single standard payment method:",W)):"undefined"!=typeof wc_checkout_params&&wc_checkout_params.chosen_payment_method&&(W=wc_checkout_params.chosen_payment_method,console.log("Using WooCommerce chosen payment method:",W))}h.payment_method=W||"",g=N&&!0}else g=!1;if(console.log("Billing details valid:",v),console.log("Shipping fields valid:",l),console.log("Final validation status:",g),console.log("Customer data collected:",h),_.length>0&&(d="Please fill in the following required fields before checkout:\n• "+_.join("\n• ")),!g)return alert(d),e(".wa-checkout-error").length&&e("html, body").animate({scrollTop:e(".wa-checkout-error").first().offset().top-100},500),!1;c.prop("disabled",!0).text("Processing..."),console.log("Sending AJAX request to save order"),e.ajax({url:waCheckoutFrontend.ajaxUrl,type:"POST",data:{action:"wa_save_order",nonce:waCheckoutFrontend.nonce,message:m,customer:h},success:function(e){console.log("AJAX response:",e),e.success?(console.log("Order saved successfully, ID: "+e.data.order_id),window.open(p,"_blank")):(console.error("Failed to save order:",e.data),alert("Error: "+e.data))},error:function(e,i,a){console.error("AJAX error:",a),alert("Error: Could not process your order. Please try again.")},complete:function(){c.prop("disabled",!1).text("Checkout via WhatsApp")}})})),e("<style>.wa-checkout-error { border: 1px solid red !important; background-color: #fff8f8 !important; }</style>").appendTo("head")}));